(function(u,s){typeof exports=="object"&&typeof module<"u"?s(exports):typeof define=="function"&&define.amd?define(["exports"],s):(u=typeof globalThis<"u"?globalThis:u||self,s(u.Filter={}))})(this,function(u){"use strict";var L=Object.defineProperty;var C=(u,s,f)=>s in u?L(u,s,{enumerable:!0,configurable:!0,writable:!0,value:f}):u[s]=f;var d=(u,s,f)=>(C(u,typeof s!="symbol"?s+"":s,f),f);function s(t,e){return t.split(".").reduce((r,i)=>r===void 0?r:r[i],e)}class f{constructor(e,r){d(this,"definition");d(this,"properties");this.definition=e;const i=Array.isArray(e.propertyKey)?e.propertyKey:[e.propertyKey];this.properties=i.map(n=>s(n,r))}}class g extends f{validate(){return this.definition.value===null||typeof this.definition.value!="number"||this.properties.length!==2?!1:typeof this.properties[0]=="number"&&typeof this.properties[1]=="number"}resolve(){const e=Math.min(...this.properties),r=Math.max(...this.properties),i=this.definition.value>=e&&this.definition.value<=r;return{score:i?1:0,isMatch:i,isPerfectMatch:i}}}class m extends f{validate(){return this.definition.value===null||this.properties.length!==1?!1:typeof this.properties[0]=="boolean"}resolve(){const e=this.properties[0]===this.definition.value;return{score:e?1:0,isMatch:e,isPerfectMatch:e}}}class M extends f{validateArray(e){return e==null||!Array.isArray(e)?!1:e.every(r=>typeof r=="number"||typeof r=="string")}validate(){return!this.validateArray(this.definition.value)||!this.definition.value.length?!1:this.validateArray(this.properties[0])}resolve(){const e=new Set(this.properties[0]),r=new Set(this.definition.value),i=e.intersection(r),n=i.size/r.size;return{score:n,isMatch:n>0,isPerfectMatch:n===1,matches:Array.from(i)}}}class A extends f{validate(){return this.definition.value===null||this.definition.minLength!==void 0&&this.definition.value.length<this.definition.minLength||!this.properties.length?!1:this.properties.every(e=>typeof e=="string")}resolve(){for(let e=0;e<this.properties.length;e++)if(this.properties[e].toLowerCase().includes(this.definition.value.toLowerCase()))return{score:1,isMatch:!0,isPerfectMatch:!0};return{score:0,isMatch:!1,isPerfectMatch:!1}}}class w extends f{validate(){return this.definition.value===null||!Array.isArray(this.definition.value)||this.definition.value.length!==2||typeof this.definition.value[0]!="number"||typeof this.definition.value[1]!="number"||this.properties.length!==1?!1:typeof this.properties[0]=="number"}resolve(){const e=Math.min(...this.definition.value),r=Math.max(...this.definition.value),i=this.properties[0]>=e&&this.properties[0]<=r;return{score:i?1:0,isMatch:i,isPerfectMatch:i}}}class b extends f{validate(){return this.definition.value===null||this.properties.length!==1?!1:Array.isArray(this.properties[0])?this.properties[0].every(e=>typeof e=="string"||typeof e!="number"):typeof this.properties[0]=="string"||typeof this.properties[0]=="number"}resolve(){const e=Array.isArray(this.properties[0])?this.properties[0].includes(this.definition.value):this.properties[0]===this.definition.value;return{score:e?1:0,isMatch:e,isPerfectMatch:e}}}function x(t){return t?(Array.isArray(t)?t:[t]).map(r=>{const i=r[0];return(i==="+"||i==="-")&&(r=r.substring(1)),{property:r,direction:i==="-"?"ascending":"descending"}}):[]}function y(t,e,r){return r==="ascending"?e-t:t-e}function P(t,e,r){return r==="ascending"?t?-1:1:t?1:-1}function S(t,e,r){return r==="ascending"?t<e?1:-1:t<e?-1:1}function F(t,e){const r=x(e);return t.sort((i,n)=>{if(i.score!==n.score)return n.score-i.score;for(let o=0;o<r.length;o++){const a=s(r[o].property,i.item),c=s(r[o].property,n.item);if(a!==c&&typeof a==typeof c){if(typeof a=="number")return y(a,c,r[o].direction);if(typeof a=="boolean")return P(a,c,r[o].direction);if(typeof a=="string")return S(a,c,r[o].direction);if(a instanceof Date)return y(a.valueOf(),c.valueOf(),r[o].direction)}}return 0})}function k(t,e){switch(e.kind){case"between":return new g(e,t);case"boolean":return new m(e,t);case"multi":return new M(e,t);case"query":return new A(e,t);case"range":return new w(e,t);case"value":return new b(e,t)}}function B(t,e){const r=e.map(l=>k(t,l)),i={};let n=0,o=0,a=0,c=!1;return r.forEach(l=>{if(c||!l.validate())return;const h=l.resolve();if(l.definition.isStrict&&!h.isPerfectMatch){c=!0;return}const v=l.definition.weight??1;if(n+=v,a+=h.score,o+=h.score*v,h.matches){let p=l.definition.key;p||(p=Array.isArray(l.definition.propertyKey)?l.definition.propertyKey[0]:l.definition.propertyKey),i[p]=h.matches}}),c?{item:t,unweightedScore:0,score:0,isMatch:!1,isPerfectMatch:!1,matches:{},isStrictZero:c}:n?{item:t,unweightedScore:a,score:o/n,isMatch:o>0,isPerfectMatch:o===n,matches:i,isStrictZero:c}:{item:t,unweightedScore:1,score:1,isMatch:!0,isPerfectMatch:!0,matches:{},isStrictZero:!1}}function K(t,e,r){if(!t.length)return[];const i=t.map(n=>B(n,e));return F(i,r)}u.filter=K,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});
