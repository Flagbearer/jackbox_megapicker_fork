{"version":3,"file":"renderers.js","sources":["../../src/main/renderers.ts"],"sourcesContent":["import { normalizeUrlToBase } from '@sentry/utils';\nimport { app } from 'electron';\n\nimport { onWebContentsCreated } from './electron-normalize';\n\ninterface Renderer {\n  id: number;\n  url?: string;\n  title?: string;\n}\n\nlet RENDERERS: Map<number, Renderer> | undefined;\n\n/**\n * Enable tracking of renderer properties via events\n *\n * This allows us to get the last known state of a renderer even if it's been destroyed\n **/\nexport function trackRendererProperties(): void {\n  if (RENDERERS) {\n    return;\n  }\n\n  const renderers = (RENDERERS = new Map<number, Renderer>());\n\n  function updateUrl(id: number, url: string): void {\n    const state = renderers.get(id) || { id };\n    state.url = normalizeUrlToBase(url, app.getAppPath());\n    renderers.set(id, state);\n  }\n\n  function updateTitle(id: number, title: string): void {\n    const state = renderers.get(id) || { id };\n    state.title = title;\n    renderers.set(id, state);\n  }\n\n  onWebContentsCreated((contents) => {\n    const id = contents.id;\n\n    contents.on('did-navigate', (_, url) => updateUrl(id, url));\n    contents.on('did-navigate-in-page', (_, url) => updateUrl(id, url));\n    contents.on('page-title-updated', (_, title) => updateTitle(id, title));\n\n    contents.on('destroyed', () => {\n      // We need to delay since consumers of this API sometimes need to\n      // access the state shortly after a renderer is destroyed\n      setTimeout(() => {\n        renderers.delete(id);\n      }, 5000);\n    });\n  });\n}\n\n/** Gets the properties for a renderer */\nexport function getRendererProperties(id: number): Renderer | undefined {\n  return RENDERERS?.get(id);\n}\n"],"names":[],"mappings":";;;;AAWA,IAAI,SAA4C,CAAC;AAEjD;;;;AAII;SACY,uBAAuB,GAAA;AACrC,IAAA,IAAI,SAAS,EAAE;QACb,OAAO;AACR,KAAA;IAED,MAAM,SAAS,IAAI,SAAS,GAAG,IAAI,GAAG,EAAoB,CAAC,CAAC;AAE5D,IAAA,SAAS,SAAS,CAAC,EAAU,EAAE,GAAW,EAAA;AACxC,QAAA,MAAM,KAAK,GAAG,SAAS,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,EAAE,EAAE,EAAE,CAAC;AAC1C,QAAA,KAAK,CAAC,GAAG,GAAG,kBAAkB,CAAC,GAAG,EAAE,GAAG,CAAC,UAAU,EAAE,CAAC,CAAC;AACtD,QAAA,SAAS,CAAC,GAAG,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC;KAC1B;AAED,IAAA,SAAS,WAAW,CAAC,EAAU,EAAE,KAAa,EAAA;AAC5C,QAAA,MAAM,KAAK,GAAG,SAAS,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,EAAE,EAAE,EAAE,CAAC;AAC1C,QAAA,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC;AACpB,QAAA,SAAS,CAAC,GAAG,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC;KAC1B;AAED,IAAA,oBAAoB,CAAC,CAAC,QAAQ,KAAI;AAChC,QAAA,MAAM,EAAE,GAAG,QAAQ,CAAC,EAAE,CAAC;AAEvB,QAAA,QAAQ,CAAC,EAAE,CAAC,cAAc,EAAE,CAAC,CAAC,EAAE,GAAG,KAAK,SAAS,CAAC,EAAE,EAAE,GAAG,CAAC,CAAC,CAAC;AAC5D,QAAA,QAAQ,CAAC,EAAE,CAAC,sBAAsB,EAAE,CAAC,CAAC,EAAE,GAAG,KAAK,SAAS,CAAC,EAAE,EAAE,GAAG,CAAC,CAAC,CAAC;AACpE,QAAA,QAAQ,CAAC,EAAE,CAAC,oBAAoB,EAAE,CAAC,CAAC,EAAE,KAAK,KAAK,WAAW,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC,CAAC;AAExE,QAAA,QAAQ,CAAC,EAAE,CAAC,WAAW,EAAE,MAAK;;;YAG5B,UAAU,CAAC,MAAK;AACd,gBAAA,SAAS,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;aACtB,EAAE,IAAI,CAAC,CAAC;AACX,SAAC,CAAC,CAAC;AACL,KAAC,CAAC,CAAC;AACL,CAAC;AAED;AACM,SAAU,qBAAqB,CAAC,EAAU,EAAA;IAC9C,OAAO,SAAS,KAAT,IAAA,IAAA,SAAS,KAAT,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,SAAS,CAAE,GAAG,CAAC,EAAE,CAAC,CAAC;AAC5B;;;;"}